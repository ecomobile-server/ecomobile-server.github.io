---
import PostHog from '../components/posthog.astro';
import { SEO } from "astro-seo";
import "../styles/global.css";

interface Props {
  title?: string;
  description?: string;
  image?: string;
  keywords?: string;
}

const {
  title = "Tuyển dụng Project Manager - EPM Gen 2.0 - Eco Mobile",
  description = "Tuyển dụng Project Manager tại Eco Mobile thông qua chương trình EPM Gen 2.0. Cơ hội phát triển sự nghiệp và trở thành nhà lãnh đạo tương lai.",
  image = "/images/og/banner.jpg",
  keywords = "tuyển dụng Project Manager, Project Manager Eco Mobile, việc làm Project Manager, IT Project Manager, PM phần mềm, PM công nghệ, Software Project Manager, Tech Project Manager, quản lý dự án IT, việc làm IT, Eco Mobile, EPM, Gen 2.0"
} = Astro.props;

const ga4MeasurementId = import.meta.env.PUBLIC_GA4_MEASUREMENT_ID;
const environment = import.meta.env.PUBLIC_ENVIRONMENT || 'development';
---

<html lang="vi">
  <head>
    <meta name="google-site-verification" content="uwdOTUIJ9NTG7FBJKQL5jAqjkFBHd_L9-Vkj_JOw634" />
    <SEO
      charset="UTF-8"
      title={title}
      description={description}
      openGraph={{
        basic: {
          title: title,
          type: "website",
          image: new URL(image, "https://epm.ecomobile.vn").href,
          url: "https://epm.ecomobile.vn",
        },
        optional: {
          locale: "vi_VN",
          siteName: "EPM Gen 2.0 - Eco Mobile",
          description: description,
        }
      }}
       extend={{
        link: [
          { rel: "icon", href: "/favicon.ico" },
          { rel: "icon", type: "image/svg+xml", href: "/favicon.svg" }
        ],
        meta: [
          { name: "viewport", content: "width=device-width" },
          { name: "generator", content: Astro.generator },
          { name: "keywords", content: keywords },
        ],
      }}
    />

    <PostHog />

    <!-- Google Analytics 4 -->
    {ga4MeasurementId && environment === 'production' && (
      <>
        <script is:inline async src={`https://www.googletagmanager.com/gtag/js?id=${ga4MeasurementId}`}></script>
        <script is:inline define:vars={{ ga4MeasurementId }}>
          window.dataLayer = window.dataLayer || [];
          window.gtag = function(){window.dataLayer.push(arguments);};
          window.gtag('js', new Date());
          window.gtag('config', ga4MeasurementId, {
            send_page_view: true, // Let GA4 handle page views with built-in traffic source tracking
          });
        </script>
      </>
    )}

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <slot />
  </body>
</html>

<script>
  import { initScrollTracking, getDeviceType } from '../utils/analytics';

  // Initialize tracking on load
  window.addEventListener('load', () => {
    // Set device type as user property for all GA4 events
    if (window.gtag) {
      window.gtag('set', 'user_properties', {
        device_type: getDeviceType()
      });
    }

    // Initialize scroll tracking
    initScrollTracking();
  });
</script>
